# JMX Exporter config for Spark Executors
startDelaySeconds: 0
host: 0.0.0.0           # <--- CRITICAL FIX: Ensures binding to all network interfaces
port: 7072              # <--- Ensure this matches the port in your docker-compose.yml
lowercaseOutputName: true
lowercaseOutputLabelNames: true
whitelistObjectNames:
  # JVM Metrics
  - 'java.lang:type=Memory'
  - 'java.lang:type=GarbageCollector,name=*'
  - 'java.lang:type=Threading'

  # Spark Executor Metrics
  - 'metrics:name=executor.*'
  - 'metrics:name=BlockManager.*'

rules:
  # JVM Memory
  - pattern: 'java.lang<type=Memory>HeapMemoryUsage(.+)'
    name: 'jvm_heap_memory_$1'
    type: GAUGE

  # Garbage Collection
  - pattern: 'java.lang<type=GarbageCollector, name=(.+?)><CollectionCount|CollectionTime>'
    name: 'jvm_gc_${0}_${1}'
    type: GAUGE
    labels:
      gc_name: '$1'

  # Executor Metrics
  - pattern: 'metrics<name=(.+?)><(.+?)>'
    name: 'spark_$1_$2'
    type: GAUGE